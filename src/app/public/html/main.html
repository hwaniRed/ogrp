<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" type="text/css" href="../css/main.css">
</head>
<body>
    <header>
        <nav>
            <a href="#">Home</a>
            <a href="#">Notifications</a>
        </nav>
    </header>
    <div class="feed">
        <div class="post">
            <div class="profile-info">
                <img src="https://via.placeholder.com/40" alt="Profile Image">
                <h3>Username</h3>
            </div>
            <div class="slider">
                <div class="slides">
                    <div class="slide" id="sld_1"><img src="https://via.placeholder.com/300" alt="Post Image"></div>
                    <div class="slide" id="sld_2"><img src="https://via.placeholder.com/300" alt="Post Image"></div>
                    <div class="slide" id="sld_3"><img src="https://via.placeholder.com/300" alt="Post Image"></div>
                    <!-- 다른 이미지들 -->
                </div>
                <div class="image-counter">1 / 2</div>
            </div>
            <div class="interaction-icons">
                <div class="item"><a href="#"><i class="material-icons">favorite</i></a></div>
                <div class="item show-comments"><a href="#"><i class="material-icons">comments</i></a></div>
            </div>
            <div class="post-content">
                <h3>Username</h3>
                <p>
                    <span class="first-line">Beautiful sunset! 🌅 #sunset #nature</span>
                    <span class="more-dots">...</span>
                    <span class="full-text">A beautiful sunset over the mountains. Nature at its finest.</span>
                </p>
                <div class="read-more">더보기</div>
            </div>
            <div class="comments">
                <p>Awesome photo!</p>
                <p>Where was this taken?</p>
                <!-- 더 많은 댓글 -->
            </div>
        </div>

        <div class="post">
            <div class="profile-info">
                <img src="https://via.placeholder.com/40" alt="Profile Image">
                <h3>Username</h3>
            </div>
            <div class="post-image">
                <img src="https://via.placeholder.com/300" alt="Post Image">
            </div>
            <div class="interaction-icons">
                <div class="item"><a href="#"><i class="material-icons">favorite</i></a></div>
                <div class="item"><a href="#"><i class="material-icons">comments</i></a></div>
            </div>
            <div class="post-content">
                <h3>Username</h3>
                <p>Delicious brunch with friends! 🥑🍳 #brunch #foodie</p>
            </div>
            <div class="comments">
                <p>Awesome photo!</p>
                <p>Where was this taken?</p>
                <!-- 더 많은 댓글 -->
            </div>
        </div>

        <div class="post">
            <div class="profile-info">
                <img src="https://via.placeholder.com/40" alt="Profile Image">
                <h3>Username</h3>
            </div>
            <div class="post-image">
                <img src="https://via.placeholder.com/300" alt="Post Image">
            </div>
            <div class="interaction-icons">
                <div class="item"><a href="#"><i class="material-icons">favorite</i></a></div>
                <div class="item"><a href="#"><i class="material-icons">comments</i></a></div>
            </div>
            <div class="post-content">
                <h3>Username</h3>
                <p>Exploring the city streets. 🏙️ #citylife #adventure</p>
            </div>
            <div class="comments">
                <p>Awesome photo!</p>
                <p>Where was this taken?</p>
                <!-- 더 많은 댓글 -->
            </div>
        </div>
    </div>
    
    <div class="popup-container">
        <div class="popup-content">
            <button class="close-popup">&times;</button>
            <h2>댓글</h2>
            <!-- 댓글 팝업 내부의 댓글 아이템 -->
            <!-- 댓글 아이템 1 -->
            <div class="comment">
                <div class="comment-author">
                    <img src="https://via.placeholder.com/20" alt="Profile Image">
                </div>
                <div class="comment-details">
                    <div class="comment-username">사용자1</div>
                    <div class="comment-content">
                        <p>댓글 본문 내용...</p>
                    </div>
                </div>
                <button class="like-comment"><i class="material-icons">favorite_border</i></button>
            </div>
            <!-- 댓글 아이템 2 -->
            <div class="comment">
                <div class="comment-author">
                    <img src="https://via.placeholder.com/20" alt="Profile Image">
                </div>
                <div class="comment-details">
                    <div class="comment-username">사용자2</div>
                    <div class="comment-content">
                        <p>댓글 본문 내용...</p>
                    </div>
                </div>
                <button class="like-comment"><i class="material-icons">favorite_border</i></button>
            </div>
            <!-- ... 더 많은 댓글 아이템 추가 가능 -->
            <div class="comment-input-container">
                <div class="profile-image">
                    <img src="https://via.placeholder.com/20" alt="Profile Image">
                </div>
                <input type="text" class="comment-input" placeholder="댓글을 입력하세요...">
                <button class="post-button">게시</button>
            </div>
        </div>
    </div>

    <!-- More posts go here -->
    <!-- ... -->
    <footer>
        <a href="#"><i class="material-icons">home</i></a>
        <a href="#"><i class="material-icons">search</i></a>
        <a href="#"><i class="material-icons">add</i></a>
        <a href="#"><i class="material-icons">notifications</i></a>
        <a href="#"><i class="material-icons">person</i></a>
    </footer>
    <script>

        document.addEventListener('DOMContentLoaded', function(){
            
            headerAction();

            sliderSettings();

            commentsPopupSetting();
        });

        headerAction = () =>{

            let lastScrollPosition = 0;
            const header = document.querySelector("header");

            window.addEventListener("scroll", () => {
                const currentScrollPosition = window.scrollY;

                if (currentScrollPosition > lastScrollPosition) {
                    header.classList.add("hidden");
                } else {
                    header.classList.remove("hidden");
                }

                // 스크롤이 맨 상단에 있을 때는 헤더를 나타나게 함
                if (currentScrollPosition <= 0) {
                    header.classList.remove("hidden");
                    header.classList.add("show-header");
                } else {
                    header.classList.remove("show-header");
                }

                lastScrollPosition = currentScrollPosition;
            });

        }

        sliderSettings = () => {

            const slider = document.querySelector('.slider');
            const slides = document.querySelectorAll('.slide');

            let isDragging = false;
            let startPos = 0;
            let currentTranslate = 0;
            let prevTranslate = 0;
            let animationID = 0;
            let currentIndex = 0;

            slides.forEach((slide, index) => {
            const slideDragStart = (e) => {
                isDragging = true;
                startPos = e.touches ? e.touches[0].clientX : e.clientX;
                animationID = requestAnimationFrame(updateAnimation);
                slider.classList.add('grabbing');
            };

            const slideDrag = (e) => {
                if (!isDragging) return;
                const currentPosition = e.touches ? e.touches[0].clientX : e.clientX;
                const move = currentPosition - startPos;
                currentTranslate = prevTranslate + move;
            };

            const slideDragEnd = () => {
                isDragging = false;
                cancelAnimationFrame(animationID);
                const moveThreshold = slider.clientWidth / 4;
                
                if (Math.abs(currentTranslate - prevTranslate) > moveThreshold) {
                if (currentTranslate < prevTranslate && currentIndex < slides.length - 1) {
                    currentIndex++;
                } else if (currentTranslate > prevTranslate && currentIndex > 0) {
                    currentIndex--;
                }
                }
                
                goToSlide(currentIndex);
                slider.classList.remove('grabbing');
            };

            const updateAnimation = () => {
                slider.style.transform = `translateX(${currentTranslate}px)`;
                if (isDragging) {
                animationID = requestAnimationFrame(updateAnimation);
                }
            };

            const goToSlide = (index) => {

                console.log("index : " , index);
                
                currentIndex = index;
                prevTranslate = currentTranslate = -currentIndex * slider.clientWidth;
                updateAnimation();
            };

            slide.addEventListener('mousedown', slideDragStart);
            slide.addEventListener('touchstart', slideDragStart);
            slide.addEventListener('mouseup', slideDragEnd);
            slide.addEventListener('touchend', slideDragEnd);
            slide.addEventListener('mouseleave', slideDragEnd);
            slide.addEventListener('mousemove', slideDrag);
            slide.addEventListener('touchmove', slideDrag);
            });

            // Prevent text selection during dragging
            slider.addEventListener('dragstart', (e) => e.preventDefault());

        }

        
        const sliderContainer = document.querySelector('.slider');
        const imageCounter = document.querySelector('.image-counter');
        const images = sliderContainer.querySelectorAll('img');
        const sliderWidth = sliderContainer.clientWidth;

        let currentIndex = 0;

        function updateImageCounter() {
            imageCounter.textContent = `${currentIndex + 1} / ${images.length}`;
        }

        function showImage(index) {
            const offset = index * -sliderWidth;
            sliderContainer.style.transform = `translateX(${offset}px)`;
            currentIndex = index;
            updateImageCounter();
        }

        updateImageCounter();

        sliderContainer.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % images.length;
            showImage(currentIndex);
        });

        // 최초에 첫 번째 이미지 표시
        showImage(currentIndex);

        const postContents = document.querySelectorAll('.post-content');

        postContents.forEach((content) => {
            const firstLine = content.querySelector('.first-line');
            const moreDots = content.querySelector('.more-dots');
            const fullText = content.querySelector('.full-text');
            const readMoreButton = content.querySelector('.read-more');
            
            if(readMoreButton != null){
                readMoreButton.addEventListener('click', () => {
                    if (content.style.maxHeight === '60px') {
                        fullText.style.display = 'none';
                        firstLine.style.display = 'none';
                        moreDots.style.display = 'inline';
                        readMoreButton.textContent = '더보기';
                    } else {
                        content.style.maxHeight = 'none';
                        moreDots.style.display = 'none';
                        firstLine.style.display = 'inline';
                        fullText.style.display = 'inline';
                        readMoreButton.style.display = 'none';
                        readMoreButton.textContent = '접기';
                    }
                });
            }
        });

        commentsPopupSetting = () =>{
            const showCommentsButtons = document.querySelectorAll('.show-comments');
            const popupContainer = document.querySelector('.popup-container');
            const popupContent = popupContainer.querySelector('.popup-content');
            const closePopupButton = popupContent.querySelector('.close-popup');

            showCommentsButtons.forEach((button) => {
                button.addEventListener('click', () => {
                    popupContainer.classList.add('active');
                    popupContent.classList.add('active');
                });
            });

            closePopupButton.addEventListener('click', () => {
                popupContainer.classList.remove('active'); // 팝업 비활성화
                popupContent.classList.remove('active');
            });
        }


        


    </script>
</body>
</html>